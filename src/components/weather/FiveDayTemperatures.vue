<template>
  <div>
    <b-overlay 
      :show="useAutoGeneratedLocation && !Object.keys(fiveDayWeatherForecast).length" 
      spinner-variant="primary"
      spinner-type="grow"
      spinner-large
      rounded="sm"
    >
      <b-card v-if="useAutoGeneratedLocation && !Object.keys(fiveDayWeatherForecast).length" title="Loading 5 Day Forecast">
      </b-card>
    </b-overlay>
    <b-card v-if="Object.keys(fiveDayWeatherForecast).length" title="5 Day Forecast" :sub-title="cityStateLocation ? cityStateLocation.city + ', ' + cityStateLocation.principalSubdivision : null">
        <b-card v-if="weekdays.Monday && weekdays.Monday.weatherData.length" title="Monday" :sub-title="weekdays.Monday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Monday" />
        </b-card>
        <b-card v-if="weekdays.Tuesday && weekdays.Tuesday.weatherData.length" title="Tuesday" :sub-title="weekdays.Tuesday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Tuesday" />
        </b-card>
        <b-card v-if="weekdays.Wednesday && weekdays.Wednesday.weatherData.length" title="Wednesday" :sub-title="weekdays.Wednesday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Wednesday" />
        </b-card>
        <b-card v-if="weekdays.Thursday && weekdays.Thursday.weatherData.length" title="Thursday" :sub-title="weekdays.Thursday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Thursday" />
        </b-card>
        <b-card v-if="weekdays.Friday && weekdays.Friday.weatherData.length" title="Friday" :sub-title="weekdays.Friday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Friday" />
        </b-card>
        <b-card v-if="weekdays.Saturday && weekdays.Saturday.weatherData.length" title="Saturday" :sub-title="weekdays.Saturday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Saturday" />
        </b-card>
        <b-card v-if="weekdays.Sunday && weekdays.Sunday.weatherData.length" title="Sunday" :sub-title="weekdays.Sunday.date" style="max-height: 70%">
          <weekday-weather-card :weekdayWeather="weekdays.Sunday" />
        </b-card>
    </b-card>
    <div v-if="!useAutoGeneratedLocation && !Object.keys(fiveDayWeatherForecast).length">
      <b-jumbotron 
        header="Search a location to see the five day weather forecast" 
        lead="The app was not able to find your location"
        bg-variant="warning"
      >
      </b-jumbotron>
    </div>
  </div>
</template>

<script>
import moment from 'moment'; 
import { mapGetters, mapActions } from "vuex";
import WeekdayWeatherCard from './WeekdayWeatherCard.vue'

export default {
    name: 'FiveDayTemperatures',
    data() {
      return {
        dayLookupTable: {
          1: 'Monday',
          2: 'Tuesday',
          3: 'Wednesday',
          4: 'Thursday',
          5: 'Friday',
          6: 'Saturday',
          7: 'Sunday'
        },
        uniqueTimes: []
      }
    },
    components: {
      WeekdayWeatherCard
    },
    methods: {
      ...mapActions('weatherForecast', ['getFiveDayWeatherForecast'])
    },
    computed: {
      ...mapGetters('weatherForecast', ['fiveDayWeatherForecast']),
      ...mapGetters(['useAutoGeneratedLocation', 'cityStateLocation']),
      weekdays() {
        const data = {};
        this.fiveDayWeatherForecast.map(day => {
          // const dateString  = day.dt_txt.split(' ')[0];
          // console.log(dateString)
          // this.uniqueTimes.indexOf(dateString.split(' ')[0]) === -1 ? this.uniqueTimes.push(dateString) : null
          const convertTime = new Date(day.dt_txt);
          const getDay = convertTime.getDay();
          const mapDayToLabel = this.dayLookupTable[getDay]
          if (!data[mapDayToLabel]) { 
            data[mapDayToLabel] = {
              'date': null,
              'weatherData': []
            }; 
          } else {
            data[mapDayToLabel]['date'] = moment(day.dt_txt).format('MMMM Do YYYY')
            data[mapDayToLabel]['weatherData'].push(day) 
          }
        });
        return data
      }
    }
}
</script>